import{a as He,b as C,G as _e,P as Nt,c as Wt,D as Xt}from"../chunks/CiZ-rBY8.js";import"../chunks/DsnmJJEf.js";import{a0 as Ze,a1 as ge,a2 as T,a3 as n,aa as V,a4 as A,a5 as pe,a6 as r,ai as ue,a7 as l,b4 as Ft,o as e,a9 as O,ab as X,a8 as P,ac as u,ad as Y,av as le,aY as ea,aT as ta}from"../chunks/C-QRPYMU.js";import{h as aa}from"../chunks/DEZGI6pG.js";import{a as la,g as jt}from"../chunks/CtAzj6bH.js";import{s as ra,O as na}from"../chunks/BAv6hWvQ.js";import{r as N,s as Rt,a as ia,b as sa}from"../chunks/BvaJcb-S.js";import{s as Vt}from"../chunks/B_MYmuK7.js";import{p as z}from"../chunks/CN1D4ans.js";import{E as Lt}from"../chunks/cqce9B6v.js";import{o as oa}from"../chunks/DLbg6C1x.js";import{i as re}from"../chunks/D6BGfUMK.js";import{e as he,i as be}from"../chunks/DLRb4NzI.js";import{i as $t,s as Ot}from"../chunks/aiiB4YHO.js";import{s as va}from"../chunks/BJYZ7QGz.js";const ua=!1,da=async({fetch:R})=>{try{const g=await R(`${He}/api/evaluator`);if(g.ok){const a=await g.json();let d=await R(`${He}/api/study-program`);const p=await d.json();d=await R(`${He}/api/student`);const w=await d.json();return{referenten:a,students:w,study_programs:p}}else return console.error("Fehler beim Laden der Referenten:",g.status),{referenten:[]}}catch(g){return console.error("Server nicht erreichbar:",g),{referenten:[]}}},Ya=Object.freeze(Object.defineProperty({__proto__:null,load:da,ssr:ua},Symbol.toStringTag,{value:"Module"}));var ca=T('<div class="erfassen-noten-container svelte-1iqql48"><div class="block"><div class="main-label svelte-1iqql48">Referent</div> <div class="search-row svelte-1iqql48"><!></div> <div class="grades-row svelte-1iqql48"><div class="grade-group svelte-1iqql48"><span class="grade-label svelte-1iqql48">Punkte<br/>Arbeit:</span> <input type="number" class="grade-input svelte-1iqql48" placeholder="-" min="0" max="100" step="1"/></div> <div class="grade-group svelte-1iqql48"><span class="grade-label svelte-1iqql48">Punkte<br/>Kolloquium:</span> <input type="number" class="grade-input svelte-1iqql48" placeholder="-" min="0" max="100" step="1"/></div></div></div> <div class="block"><div class="main-label svelte-1iqql48">Korreferent</div> <div class="search-row svelte-1iqql48"><!></div> <div class="grades-row svelte-1iqql48"><div class="grade-group svelte-1iqql48"><span class="grade-label svelte-1iqql48">Punkte<br/>Arbeit:</span> <input type="number" class="grade-input svelte-1iqql48" placeholder="-" min="0" max="100" step="1"/></div> <div class="grade-group svelte-1iqql48"><span class="grade-label svelte-1iqql48">Punkte<br/>Kolloquium:</span> <input type="number" class="grade-input svelte-1iqql48" placeholder="-" min="0" max="100" step="1"/></div></div></div> <div class="block footer-block svelte-1iqql48"><div class="left-col svelte-1iqql48"><div class="main-label svelte-1iqql48">Kommentar</div> <textarea class="comment-box svelte-1iqql48"></textarea></div> <div class="right-col svelte-1iqql48"><div class="total-wrapper svelte-1iqql48"><div class="total-label svelte-1iqql48">Gesamtpunkte<br/>der Arbeit:</div> <div> </div></div></div></div></div>');function ma(R,g){ge(g,!0);let a=z(g,"evaluators",19,()=>[]),d=z(g,"data",31,()=>ue({mainEvaluator:null,secondEvaluator:null,mainEvaluatorWorkMark:null,mainEvaluatorColloquiumMark:null,secondEvaluatorWorkMark:null,secondEvaluatorColloquiumMark:null,comment:""}));function p(s){let i=s.target.value;if(i==="")return;let I=Number(i);(I<0||I>100||!Number.isInteger(I)||i.includes(".")||i.includes(","))&&(s.target.value="")}let w=O(()=>{const i=[d().mainEvaluatorWorkMark,d().mainEvaluatorColloquiumMark,d().secondEvaluatorWorkMark,d().secondEvaluatorColloquiumMark].filter(q=>q!==null&&q!==""&&!isNaN(q));return i.length<4?null:(i.reduce((q,ie)=>Number(q)+Number(ie),0)/4).toFixed(1)});function h(s){if(!s)return"";const i=Number(s);return i>=87.5?"mark1":i>=72.5?"mark2":i>=57.5?"mark3":i>=50?"mark4":"mark5"}let v=O(()=>h(e(w)));var y=ca(),D=r(y),B=n(r(D),2),F=r(B);Lt(F,{get data(){return a()},get selectedEvaluator(){return d().mainEvaluator},set selectedEvaluator(s){d(d().mainEvaluator=s,!0)}}),l(B);var J=n(B,2),W=r(J),x=n(r(W),2);N(x),x.__input=p,l(W);var E=n(W,2),K=n(r(E),2);N(K),K.__input=p,l(E),l(J),l(D);var U=n(D,2),H=n(r(U),2),Z=r(H);Lt(Z,{get data(){return a()},get selectedEvaluator(){return d().secondEvaluator},set selectedEvaluator(s){d(d().secondEvaluator=s,!0)}}),l(H);var c=n(H,2),k=r(c),m=n(r(k),2);N(m),m.__input=p,l(k);var f=n(k,2),S=n(r(f),2);N(S),S.__input=p,l(f),l(c),l(U);var j=n(U,2),L=r(j),$=n(r(L),2);Ft($),l(L);var ee=n(L,2),ne=r(ee),Q=n(r(ne),2),de=r(Q,!0);l(Q),l(ne),l(ee),l(j),l(y),V(()=>{Vt(Q,1,`total-box ${e(v)??""}`,"svelte-1iqql48"),X(de,e(w)??"?")}),C(x,()=>d().mainEvaluatorWorkMark,s=>d(d().mainEvaluatorWorkMark=s,!0)),C(K,()=>d().mainEvaluatorColloquiumMark,s=>d(d().mainEvaluatorColloquiumMark=s,!0)),C(m,()=>d().secondEvaluatorWorkMark,s=>d(d().secondEvaluatorWorkMark=s,!0)),C(S,()=>d().secondEvaluatorColloquiumMark,s=>d(d().secondEvaluatorColloquiumMark=s,!0)),C($,()=>d().comment,s=>d(d().comment=s,!0)),A(R,y),pe()}Ze(["input"]);var ga=T('<button class="display-value svelte-1o0j71q" type="button" aria-label="Auswahl ändern"> </button>'),pa=T('<a href="/erstellen/student" target="_blank" class="create-btn svelte-1o0j71q" style="text-decoration: none; display: inline-block; text-align: center;">erstellen</a>'),fa=T('<div class="input-wrapper svelte-1o0j71q"><input type="text" class="svelte-1o0j71q"/> <!></div>'),_a=T('<button class="list-item svelte-1o0j71q" type="button"> </button>'),ha=T('<div class="dropdown-list svelte-1o0j71q"></div>'),ba=T('<div class="search-component svelte-1o0j71q"><div class="search-wrapper svelte-1o0j71q"><div class="input-container svelte-1o0j71q"><!></div> <button class="refresh-btn svelte-1o0j71q" type="button">⟳</button></div> <!></div>');function ya(R,g){ge(g,!0);let a=z(g,"data",19,()=>[]),d=z(g,"placeholder",3,"Student suchen"),p=z(g,"selectedStudent",15,null),w=z(g,"refresh",3,()=>{}),h=z(g,"onClear",3,()=>{}),v=P(""),y=P(!1),D=O(()=>Array.isArray(a())?a():[]),B=O(()=>e(D).filter(m=>`${m.firstName??""} ${m.lastName??""}`.toLowerCase().includes(e(v).toLowerCase())));function F(m){p(m),u(v,`${m.firstName} ${m.lastName}`),u(y,!1)}function J(){p(null),u(v,""),u(y,!0),h()()}var W=ba(),x=r(W),E=r(x),K=r(E);{var U=m=>{var f=ga();f.__click=J;var S=r(f);l(f),V(()=>X(S,`${p().firstName??""} ${p().lastName??""}`)),A(m,f)},H=m=>{var f=fa(),S=r(f);N(S),S.__input=()=>u(y,!0);var j=n(S,2);{var L=$=>{var ee=pa();A($,ee)};re(j,$=>{e(B).length===0&&e(v).length>0&&$(L)})}l(f),V(()=>Rt(S,"placeholder",d())),Y("focus",S,()=>u(y,!0)),C(S,()=>e(v),$=>u(v,$)),A(m,f)};re(K,m=>{p()?m(U):m(H,!1)})}l(E);var Z=n(E,2);Z.__click=()=>w()(),l(x);var c=n(x,2);{var k=m=>{var f=ha();he(f,21,()=>e(B),be,(S,j)=>{var L=_a();L.__click=()=>F(e(j));var $=r(L);l(L),V(()=>X($,`${e(j).firstName??""} ${e(j).lastName??""}`)),A(S,L)}),l(f),A(m,f)};re(c,m=>{e(y)&&!p()&&e(v).length>0&&e(B).length>0&&m(k)})}l(W),A(R,W),pe()}Ze(["click","input"]);var Ea=T('<button class="display-value svelte-mj807v" type="button" aria-label="Auswahl ändern"> </button>'),ka=T('<div class="input-wrapper svelte-mj807v"><input type="text" class="svelte-mj807v"/></div>'),qa=T('<button class="list-item svelte-mj807v" type="button"> </button>'),Sa=T('<div class="dropdown-list svelte-mj807v"></div>'),Ma=T('<div class="search-component svelte-mj807v"><div class="input-container svelte-mj807v"><!></div> <!></div>');function wa(R,g){ge(g,!0);let a=z(g,"data",19,()=>[]),d=z(g,"placeholder",3,"Studiengang suchen"),p=z(g,"selectedStudyProgram",3,null),w=z(g,"onSelected",3,null),h=z(g,"onCleared",3,null),v=P(""),y=P(!1),D=O(()=>Array.isArray(a())?a():[]),B=O(()=>e(D).filter(c=>`${c.title??""}`.toLowerCase().includes(e(v).toLowerCase())));function F(c){typeof w()=="function"&&w()(c),u(v,c.title??"",!0),u(y,!1)}function J(){typeof h()=="function"&&h()(),u(v,""),u(y,!0)}le(()=>{p()&&!e(y)&&u(v,p().title??"",!0)});var W=Ma(),x=r(W),E=r(x);{var K=c=>{var k=Ea();k.__click=J;var m=r(k,!0);l(k),V(()=>X(m,p().title)),A(c,k)},U=c=>{var k=ka(),m=r(k);N(m),m.__input=()=>u(y,!0),l(k),V(()=>Rt(m,"placeholder",d())),Y("focus",m,()=>u(y,!0)),C(m,()=>e(v),f=>u(v,f)),A(c,k)};re(E,c=>{p()?c(K):c(U,!1)})}l(x);var H=n(x,2);{var Z=c=>{var k=Sa();he(k,21,()=>e(B),be,(m,f)=>{var S=qa();S.__click=()=>F(e(f));var j=r(S,!0);l(S),V(()=>X(j,e(f).title)),A(m,S)}),l(k),A(c,k)};re(H,c=>{e(y)&&!p()&&e(v).length>0&&e(B).length>0&&c(Z)})}l(W),A(R,W),pe()}Ze(["click","input"]);var Da=T('<div class="student-studyprogram-hint svelte-1vgudho"><strong> </strong></div>'),Ia=T('<button type="button"> </button>'),Aa=T('<div class="pager svelte-1vgudho"><button type="button" class="pager-arrow svelte-1vgudho">←</button> <!></div>'),Ta=T("<option> </option>"),Pa=T('<button type="button" class="input-shell action-shell remove-shell svelte-1vgudho">entfernen</button>'),xa=T('<div class="erfassen-daten-arbeit-container svelte-1vgudho"><div class="card svelte-1vgudho"><div class="section svelte-1vgudho"><div class="section-title svelte-1vgudho">Student</div> <div class="row-inline student-row svelte-1vgudho"><div class="grow svelte-1vgudho"><!></div></div> <div class="field svelte-1vgudho"><div class="label svelte-1vgudho">Studiengang</div> <!> <!></div></div> <div class="divider svelte-1vgudho"></div> <div class="section svelte-1vgudho"><div class="section-title svelte-1vgudho">Arbeit</div> <div class="field svelte-1vgudho"><div class="sub-label svelte-1vgudho">Titel</div> <div class="input-shell textarea svelte-1vgudho"><textarea placeholder="-" class="svelte-1vgudho"></textarea></div></div> <div class="grid-2 svelte-1vgudho"><div class="field svelte-1vgudho"><div class="sub-label svelte-1vgudho">Startdatum</div> <div class="input-shell svelte-1vgudho"><input type="date" class="svelte-1vgudho"/></div></div> <div class="field svelte-1vgudho"><div class="sub-label svelte-1vgudho">Abgabedatum</div> <div class="input-shell svelte-1vgudho"><input type="date" class="svelte-1vgudho"/></div></div></div></div> <div class="divider svelte-1vgudho"></div> <div class="section svelte-1vgudho"><div class="section-title svelte-1vgudho">Kolloquiumsprotokoll</div> <div class="grid-3-kollo svelte-1vgudho"><div class="field svelte-1vgudho"><div class="sub-label svelte-1vgudho">Tag</div> <div class="input-shell svelte-1vgudho"><input type="date" class="svelte-1vgudho"/></div></div> <div class="field svelte-1vgudho"><div class="sub-label svelte-1vgudho">Zeit</div> <div class="input-shell svelte-1vgudho"><input type="time" class="svelte-1vgudho"/></div></div> <div class="field svelte-1vgudho"><div class="sub-label svelte-1vgudho">Dauer</div> <div class="input-shell svelte-1vgudho"><select class="svelte-1vgudho"><option>Bitte wählen</option><option>30 Min</option><option>45 Min</option><option>1 Std</option><option>1 Std 15 Min</option><option>1 Std 30 Min</option><option>1 Std 45 Min</option><option>2 Std</option><option>2 Std 15 Min</option><option>2 Std 30 Min</option><option>2 Std 45 Min</option><option>3 Std</option></select></div></div></div> <div class="grid-4 svelte-1vgudho"><div class="field svelte-1vgudho"><div class="sub-label svelte-1vgudho">Präsentation von</div> <div class="input-shell svelte-1vgudho"><input type="time" class="svelte-1vgudho"/></div></div> <div class="field svelte-1vgudho"><div class="sub-label svelte-1vgudho">Präsentation bis</div> <div class="input-shell svelte-1vgudho"><input type="time" class="svelte-1vgudho"/></div></div> <div class="field svelte-1vgudho"><div class="sub-label svelte-1vgudho">Diskussion von</div> <div class="input-shell svelte-1vgudho"><input type="time" class="svelte-1vgudho"/></div></div> <div class="field svelte-1vgudho"><div class="sub-label svelte-1vgudho">Diskussion bis</div> <div class="input-shell svelte-1vgudho"><input type="time" class="svelte-1vgudho"/></div></div></div> <div class="field svelte-1vgudho"><div class="sub-label svelte-1vgudho">Kolloquiumsstandort*</div> <div class="input-shell svelte-1vgudho"><input type="text" placeholder="-" class="svelte-1vgudho"/></div></div></div> <div class="divider svelte-1vgudho"></div> <div class="section svelte-1vgudho"><div class="veranstaltung-header svelte-1vgudho"><div class="section-title svelte-1vgudho">Veranstaltung*</div> <!></div> <div class="grid-3-event svelte-1vgudho"><div class="field svelte-1vgudho"><div class="sub-label svelte-1vgudho">Typ</div> <div class="input-shell svelte-1vgudho"><select class="svelte-1vgudho"><option disabled>Bitte wählen</option><!></select></div></div> <div class="field svelte-1vgudho"><div class="sub-label svelte-1vgudho">Datum</div> <div class="input-shell svelte-1vgudho"><input type="date" class="svelte-1vgudho"/></div></div> <div class="field svelte-1vgudho"><div class="sub-label svelte-1vgudho">&nbsp;</div> <div class="event-actions svelte-1vgudho"><button type="button" class="input-shell action-shell plus-shell svelte-1vgudho">+</button> <!></div></div></div></div></div></div>');function Ca(R,g){ge(g,!0);let a=z(g,"data",31,()=>ue({colloquium:null,colloquiumLocation:"",colloquiumDuration:null,presentationStart:"",presentationEnd:"",discussionStart:"",discussionEnd:"",title:"",startDate:"",endDate:"",studentId:null,studyProgramId:null,mainEvaluatorId:null,secondEvaluatorId:null,mainEvaluatorWorkMark:null,mainEvaluatorColloquiumMark:null,secondEvaluatorWorkMark:null,secondEvaluatorColloquiumMark:null,comment:"",events:[{eventType:"",eventDate:""}]})),d=ue({tag:"",zeit:""}),p=P(""),w=P(ue([])),h=P(null),v=P(ue([])),y=P(null),D=P(null),B=P(""),F=P(!1),J=O(()=>new Map((Array.isArray(e(v))?e(v):[]).map(t=>[t.id,t.title]))),W=O(()=>new Map((Array.isArray(e(v))?e(v):[]).map(t=>[t.id,t.degreeType]))),x=O(()=>e(h)?.studyProgramId?e(J).get(e(h).studyProgramId)??"":""),E=O(()=>e(h)?.studyProgramId?e(W).get(e(h).studyProgramId)??"":"");const K={B_A:"B.A.",B_ENG:"B.Eng.",B_SC:"B.Sc.",B_LAWS:"B.Laws.",BBA:"BBA",M_A:"M.A.",M_SC:"M.Sc.",M_ENG:"M.Eng.",M_LAWS:"M.Laws.",MBA:"MBA"};function U(t){return t?K[t]??String(t).replaceAll("_","."):""}function H(t){const o=t?.title??"",_=U(t?.degreeType);return _&&o?`${_} in ${o}`:_||o||""}let Z=O(()=>(Array.isArray(e(v))?e(v):[]).map(t=>({...t,title:H(t)}))),c=P(0),k=O(()=>(a().events??[]).length),m=O(()=>(a().events?.length??0)>0),f=O(()=>e(m)?(a().events??[])[e(c)]:{eventType:"",eventDate:""});const S=Object.entries(va).map(([t,o])=>({value:t,label:o}));le(()=>{if(a().studentId&&!e(h)&&e(w).length>0){const t=e(w).find(o=>o.id===a().studentId);t&&u(h,t,!0)}}),le(()=>{if(a().studyProgramId&&!e(D)&&e(Z).length>0&&!e(F)){const t=e(Z).find(o=>o.id===a().studyProgramId);t&&(u(D,t,!0),u(y,t.id,!0),u(B,t.title??"",!0))}!a().studyProgramId&&e(D)&&!e(F)&&(u(D,null),u(y,null),u(B,""))}),le(()=>{if(a().colloquium&&(!d.tag||!d.zeit)&&typeof a().colloquium=="string"){const o=a().colloquium.split("T");o.length>=2&&(d.tag=o[0],d.zeit=o[1].substring(0,5))}const t=a().colloquiumDuration;if(t==null||t===0){u(p,"");return}if(typeof t=="number"){u(p,String(Math.round(t/60)),!0);return}if(typeof t=="string"){const o=t.match(/\d+/);u(p,o?o[0]:"",!0)}}),le(()=>{const t=e(h)?.id??null;t!==null&&a(a().studentId=t,!0)});function j(t){if(t==null||t==="-"||t==="")return null;let o=t;if(typeof o=="string"){if(o=o.trim(),o==="-"||o==="")return null;o=o.replace(",",".")}const _=Number(o);if(!Number.isFinite(_))return null;const G=Math.trunc(_);return G<0||G>100?null:G}le(()=>{["mainEvaluatorWorkMark","mainEvaluatorColloquiumMark","secondEvaluatorWorkMark","secondEvaluatorColloquiumMark"].forEach(o=>{if(a()&&a()[o]!==void 0){const _=j(a()[o]);a()[o]!==_&&a(a()[o]=_,!0)}})});function L(t){u(D,t,!0),a(a().studyProgramId=t?.id??null,!0),u(F,!0)}function $(){u(D,null),a(a().studyProgramId=null,!0),u(F,!0)}le(()=>{if(!d.tag||!d.zeit){if(!a().colloquium)return}else a(a().colloquium=`${d.tag}T${d.zeit}`,!0)});function ee(t){u(p,t,!0);const o=Number(t);a(a().colloquiumDuration=Number.isFinite(o)&&o>0?o*60:null,!0)}function ne(){a(a().studentId=null,!0),u(h,null)}function Q(){a(a().events=[...a().events??[],{eventType:"",eventDate:""}],!0),u(c,(a().events?.length??1)-1)}function de(){const t=a().events??[];if(t.length===0)return;const _=t.filter((G,te)=>te!==e(c));a(a().events=_,!0),_.length===0?u(c,0):u(c,Math.min(e(c),_.length-1),!0)}function s(t){const o=a().events?.length??0;t<0||t>=o||u(c,t,!0)}function i(){(Array.isArray(a().events)?a().events:[]).length===0&&(a(a().events=[{eventType:"",eventDate:""}],!0),u(c,0))}function I(t){i();const o=[...a().events];o[e(c)]={...o[e(c)]??{},eventType:t},a(a().events=o,!0)}function q(t){i();const o=[...a().events];o[e(c)]={...o[e(c)]??{},eventDate:t};let _=ra(o);_.sort((G,te)=>G.eventDate>te.eventDate),a(a().events=_,!0)}const ie=t=>!!(t?.eventType||t?.eventDate);le(()=>{Array.isArray(a().events)&&(a().events.length>0&&a().events.every(t=>!ie(t))&&(a(a().events=[],!0),u(c,0)),(a().events?.length??0)===0?u(c,0):e(c)>a().events.length-1&&u(c,a().events.length-1))});async function se(){console.log("loading students..."),u(w,await _e("/api/student"),!0)}async function b(){try{u(v,await _e("/api/study-program"),!0)}catch(t){console.error("Konnte Studiengänge nicht laden:",t),u(v,[],!0)}}oa(async()=>{await Promise.all([se(),b()])});var M=xa(),ae=r(M),ye=r(ae),Ee=n(r(ye),2),Ye=r(Ee),zt=r(Ye);ya(zt,{get data(){return e(w)},placeholder:"Suche",refresh:se,onClear:ne,get selectedStudent(){return e(h)},set selectedStudent(t){u(h,t,!0)}}),l(Ye),l(Ee);var Je=n(Ee,2),Qe=n(r(Je),2);wa(Qe,{get data(){return e(Z)},placeholder:"Studiengang suchen",get selectedStudyProgram(){return e(D)},onSelected:L,onCleared:$});var Gt=n(Qe,2);{var Kt=t=>{var o=Da(),_=r(o),G=r(_);l(_),l(o),V(()=>X(G,`${e(h).firstName??""} ${e(h).lastName??""}
                            studiert ${(e(x)||"-")??""}${e(E)?` (${e(E)})`:""}
                            .`)),A(t,o)};re(Gt,t=>{e(h)&&e(h).studyProgramId&&t(Kt)})}l(Je),l(ye);var ke=n(ye,4),qe=n(r(ke),2),Xe=n(r(qe),2),et=r(Xe);Ft(et),l(Xe),l(qe);var tt=n(qe,2),Se=r(tt),at=n(r(Se),2),lt=r(at);N(lt),l(at),l(Se);var rt=n(Se,2),nt=n(r(rt),2),it=r(nt);N(it),l(nt),l(rt),l(tt),l(ke);var Me=n(ke,4),we=n(r(Me),2),De=r(we),st=n(r(De),2),ot=r(st);N(ot),l(st),l(De);var Ie=n(De,2),vt=n(r(Ie),2),ut=r(vt);N(ut),l(vt),l(Ie);var dt=n(Ie,2),ct=n(r(dt),2),oe=r(ct),Ae=r(oe);Ae.value=Ae.__value="";var Te=n(Ae);Te.value=Te.__value="30";var Pe=n(Te);Pe.value=Pe.__value="45";var xe=n(Pe);xe.value=xe.__value="60";var Ce=n(xe);Ce.value=Ce.__value="75";var Be=n(Ce);Be.value=Be.__value="90";var Ne=n(Be);Ne.value=Ne.__value="105";var We=n(Ne);We.value=We.__value="120";var je=n(We);je.value=je.__value="135";var Le=n(je);Le.value=Le.__value="150";var $e=n(Le);$e.value=$e.__value="165";var mt=n($e);mt.value=mt.__value="180",l(oe);var gt;$t(oe),l(ct),l(dt),l(we);var Oe=n(we,2),Fe=r(Oe),pt=n(r(Fe),2),ft=r(pt);N(ft),l(pt),l(Fe);var Re=n(Fe,2),_t=n(r(Re),2),ht=r(_t);N(ht),l(_t),l(Re);var Ve=n(Re,2),bt=n(r(Ve),2),yt=r(bt);N(yt),l(bt),l(Ve);var Et=n(Ve,2),kt=n(r(Et),2),qt=r(kt);N(qt),l(kt),l(Et),l(Oe);var St=n(Oe,2),Mt=n(r(St),2),wt=r(Mt);N(wt),l(Mt),l(St),l(Me);var Dt=n(Me,4),ze=r(Dt),Ut=n(r(ze),2);{var Ht=t=>{var o=Aa(),_=r(o),G=n(_,2);he(G,17,()=>Array.from({length:e(k)},(te,ce)=>ce),be,(te,ce)=>{var me=Ia(),Qt=r(me);l(me),V(()=>{Vt(me,1,`pager-num ${e(ce)===e(c)?"active":""}`,"svelte-1vgudho"),X(Qt,`[${e(ce)+1}]`)}),Y("click",me,()=>s(e(ce))),A(te,me)}),l(o),V(()=>_.disabled=e(c)===0),Y("click",_,()=>s(e(c)-1)),A(t,o)};re(Ut,t=>{e(m)&&t(Ht)})}l(ze);var It=n(ze,2),Ge=r(It),At=n(r(Ge),2),ve=r(At),fe=r(ve);fe.value=fe.__value="";var Zt=n(fe);he(Zt,17,()=>S,be,(t,o)=>{var _=Ta(),G=r(_,!0);l(_);var te={};V(()=>{X(G,e(o).label),te!==(te=e(o).value)&&(_.value=(_.__value=e(o).value)??"")}),A(t,_)}),l(ve);var Tt;$t(ve),l(At),l(Ge);var Ke=n(Ge,2),Pt=n(r(Ke),2),Ue=r(Pt);N(Ue),l(Pt),l(Ke);var xt=n(Ke,2),Ct=n(r(xt),2),Bt=r(Ct),Yt=n(Bt,2);{var Jt=t=>{var o=Pa();Y("click",o,de),A(t,o)};re(Yt,t=>{e(m)&&t(Jt)})}l(Ct),l(xt),l(It),l(Dt),l(ae),l(M),V(()=>{gt!==(gt=e(p))&&(oe.value=(oe.__value=e(p))??"",Ot(oe,e(p))),ia(fe,e(f).eventType===""),Tt!==(Tt=e(f).eventType)&&(ve.value=(ve.__value=e(f).eventType)??"",Ot(ve,e(f).eventType)),sa(Ue,e(f).eventDate)}),C(et,()=>a().title,t=>a(a().title=t,!0)),C(lt,()=>a().startDate,t=>a(a().startDate=t,!0)),C(it,()=>a().endDate,t=>a(a().endDate=t,!0)),C(ot,()=>d.tag,t=>d.tag=t),C(ut,()=>d.zeit,t=>d.zeit=t),Y("change",oe,t=>ee(t.target.value)),C(ft,()=>a().presentationStart,t=>a(a().presentationStart=t,!0)),C(ht,()=>a().presentationEnd,t=>a(a().presentationEnd=t,!0)),C(yt,()=>a().discussionStart,t=>a(a().discussionStart=t,!0)),C(qt,()=>a().discussionEnd,t=>a(a().discussionEnd=t,!0)),C(wt,()=>a().colloquiumLocation,t=>a(a().colloquiumLocation=t,!0)),Y("change",ve,t=>I(t.target.value)),Y("input",Ue,t=>q(t.target.value)),Y("click",Bt,Q),A(R,M),pe()}var Ba=T('<main class="erstellen-arbeit-container svelte-1vxvssb"><div class="header-row svelte-1vxvssb"><div class="page-title svelte-1vxvssb"> </div></div> <!> <!> <!> <div class="action-bar svelte-1vxvssb"><button class="cancel-btn svelte-1vxvssb" type="button">Abbrechen</button> <button class="save-btn svelte-1vxvssb" type="button"> </button></div></main>');function Ja(R,g){ge(g,!0);let a={};g.data.study_programs.forEach(s=>{a[s.id]=s.degreeType+" in "+s.title});let d={};g.data.students.forEach(s=>{d[s.id]=s});let p={};g.data.referenten.forEach(s=>{p[s.id]=s});let w=P(!0),h=P(0),v=P(ue({mainEvaluator:null,secondEvaluator:null,mainEvaluatorWorkMark:null,mainEvaluatorColloquiumMark:null,secondEvaluatorWorkMark:null,secondEvaluatorColloquiumMark:null,title:"",startDate:"",endDate:"",colloquium:null,colloquiumLocation:"",colloquiumDuration:null,presentationStart:"",presentationEnd:"",discussionStart:"",discussionEnd:"",studentId:null,studyProgramId:null,comment:"",events:[{eventType:"",eventDate:""}]})),y=P(ue([])),D=P(!1);function B(s){return!s||!g.data.referenten?null:g.data.referenten.find(i=>i.id===s)||{id:s}}function F(s){if(!s)return null;if(Array.isArray(s)){const[i,I,q]=s;return`${i}-${I.toString().padStart(2,"0")}-${q.toString().padStart(2,"0")}`}return s}function J(s){if(!s)return null;if(Array.isArray(s)){const[i,I,q,ie,se]=s;return`${i}-${I.toString().padStart(2,"0")}-${q.toString().padStart(2,"0")}T${ie.toString().padStart(2,"0")}:${se.toString().padStart(2,"0")}`}return s}async function W(s){try{const i=await _e(`/api/scientific-work/${s}`),I=await _e(`/api/scientific-work/${s}/events`);i&&(u(v,{...e(v),title:i.title,startDate:F(i.startDate),endDate:F(i.endDate),colloquium:J(i.colloquium),colloquiumLocation:i.colloquiumLocation,colloquiumDuration:i.colloquiumDuration,presentationStart:i.presentationStart,presentationEnd:i.presentationEnd,discussionStart:i.discussionStart,discussionEnd:i.discussionEnd,studentId:i.studentId,studyProgramId:i.studyProgramId,comment:i.comment,mainEvaluatorWorkMark:i.mainEvaluatorWorkMark,mainEvaluatorColloquiumMark:i.mainEvaluatorColloquiumMark,secondEvaluatorWorkMark:i.secondEvaluatorWorkMark,secondEvaluatorColloquiumMark:i.secondEvaluatorColloquiumMark,mainEvaluator:B(i.mainEvaluatorId),secondEvaluator:B(i.secondEvaluatorId),events:I&&I.length>0?I.map(q=>({...q,eventDate:F(q.eventDate)})):[{eventType:"",eventDate:""}]},!0),u(y,(I??[]).map(q=>q?.id).filter(q=>q!=null),!0))}catch(i){console.error("Fehler beim Laden der Arbeit:",i)}}let x=0;la(async()=>{const s=new URLSearchParams(window.location.search);if(s.has("id"))u(h,s.get("id"),!0),u(w,!1),await W(e(h)),x=e(h);else{const i=x!==0;u(w,!0),u(h,0),u(v,{mainEvaluator:null,secondEvaluator:null,mainEvaluatorWorkMark:null,mainEvaluatorColloquiumMark:null,secondEvaluatorWorkMark:null,secondEvaluatorColloquiumMark:null,title:"",startDate:"",endDate:"",colloquium:null,colloquiumLocation:"",colloquiumDuration:null,presentationStart:"",presentationEnd:"",discussionStart:"",discussionEnd:"",studentId:null,studyProgramId:null,comment:"",events:[{eventType:"",eventDate:""}]},!0),u(y,[],!0),x=0,i&&setTimeout(()=>{window.location.reload()},200)}});function E(s){const i=(s??"").toString().trim();return i===""?null:i}function K(){return{colloquium:e(v).colloquium??null,colloquiumLocation:E(e(v).colloquiumLocation),colloquiumDuration:e(v).colloquiumDuration??null,presentationStart:E(e(v).presentationStart),presentationEnd:E(e(v).presentationEnd),discussionStart:E(e(v).discussionStart),discussionEnd:E(e(v).discussionEnd),title:e(v).title,startDate:E(e(v).startDate),endDate:E(e(v).endDate),studentId:e(v).studentId??null,studyProgramId:e(v).studyProgramId??null,mainEvaluatorId:e(v).mainEvaluator?.id??null,secondEvaluatorId:e(v).secondEvaluator?.id??null,mainEvaluatorWorkMark:E(e(v).mainEvaluatorWorkMark),mainEvaluatorColloquiumMark:E(e(v).mainEvaluatorColloquiumMark),secondEvaluatorWorkMark:E(e(v).secondEvaluatorWorkMark),secondEvaluatorColloquiumMark:E(e(v).secondEvaluatorColloquiumMark),comment:E(e(v).comment)}}function U(s){return(e(v).events??[]).filter(i=>i.eventType&&i.eventDate).map(i=>({id:i.id,eventType:i.eventType,eventDate:i.eventDate,scientificWorkId:s}))}function H(){return!e(v).title||e(v).title.trim()===""?"Bitte einen Titel eingeben.":(e(v).events??[]).some(i=>i.eventType&&!i.eventDate||!i.eventType&&i.eventDate)?"Bitte bei jeder Veranstaltung Typ UND Datum ausfüllen.":null}async function Z(){const s=H();if(s){alert(s);return}if(!e(D)){u(D,!0);try{const i=K();let I=e(h);if(e(w)){const b=await Nt("/api/scientific-work",i);if(!b?.ok){b.status===400?alert("Ungültige Eingabedaten. Bitte prüfen Sie Ihre Angaben. Ein Referent muss mindestens denselben akademischen Grad vorweisen wie der zugehörige Student."):alert("Fehler beim Erstellen der Arbeit.");return}const M=await b.json();I=M?.id??M?.scientificWorkId}else{const b=await Wt(`/api/scientific-work/${e(h)}`,i);if(!b?.ok){b.status===400?alert("Ungültige Eingabedaten. Bitte prüfen Sie Ihre Angaben. Ein Referent muss mindestens denselben akademischen Grad vorweisen wie der zugehörige Student."):alert("Fehler beim Erstellen der Arbeit.");return}}if(!I){alert("Fehler: Keine ID vorhanden.");return}const q=U(I),ie=new Set(q.map(b=>b.id).filter(Boolean)),se=(e(y)??[]).filter(b=>!ie.has(b));console.debug("Speichern: Events (DTO)",q),console.debug("Speichern: Zu löschende Event-IDs",se);for(const b of se)try{const M=await Xt(`/api/event/${b}`);if(M?.ok)console.debug(`Event gelöscht: ${b}`);else{const ae=await M.text().catch(()=>"");console.error(`Event-DELETE fehlgeschlagen (${b}):`,M?.status,ae)}}catch(M){console.error(`Fehler beim Löschen des Events ${b}:`,M)}for(const b of q)try{if(b.id){const M=await Wt(`/api/event/${b.id}`,b);if(!M?.ok){const ae=await M.text().catch(()=>"");console.error(`Event-PATCH fehlgeschlagen (${b.id}):`,M?.status,ae)}}else{const M=await Nt("/api/event",b);if(!M?.ok){const ae=await M.text().catch(()=>"");console.error("Event-POST fehlgeschlagen:",M?.status,ae)}}}catch(M){console.error("Fehler beim Speichern/Aktualisieren eines Events:",M)}u(y,q.map(b=>b.id).filter(Boolean),!0),jt("/arbeiten")}catch(i){console.error("Save failed:",i),alert("Fehler beim Speichern der Arbeit.")}finally{u(D,!1)}}}function c(){jt("/arbeiten")}var k=Ba();aa("1vxvssb",s=>{ea(()=>{ta.title=`${e(w)?"Arbeit anlegen":"Arbeit bearbeiten"} - ProfIS`})});var m=r(k),f=r(m),S=r(f,!0);l(f),l(m);var j=n(m,2);na(j,{get swork(){return e(v)},get studmap(){return d},get progmap(){return a},get refmap(){return p}});var L=n(j,2);{let s=O(()=>g.data?.referenten??[]);ma(L,{get evaluators(){return e(s)},get data(){return e(v)},set data(i){u(v,i,!0)}})}var $=n(L,2);Ca($,{get data(){return e(v)},set data(s){u(v,s,!0)}});var ee=n($,2),ne=r(ee),Q=n(ne,2),de=r(Q,!0);l(Q),l(ee),l(k),V(()=>{X(S,e(w)?"ARBEIT ANLEGEN":"ARBEIT BEARBEITEN"),Q.disabled=e(D),X(de,e(D)?"Speichern...":e(w)?"Speichern":"Aktualisieren")}),Y("click",ne,c),Y("click",Q,Z),A(R,k),pe()}export{Ja as component,Ya as universal};
